name: desktop 
run-name: ${{ github.actor }} run
on: [push]

jobs:
  ubuntu:
    runs-on: ubuntu-latest
    steps:
      - run: echo "${{ runner.os }}->${{ github.event_name }}->${{ github.ref }}"

      - name: Clone repo
        uses: actions/checkout@v4
      - name: Obtain deps
        run: sudo apt -y install libcmocka0
      - name: Setup release build
        run: |
          mkdir private
          echo 'param_mode="release"' > private/build-params
      - name: Build tests
        run: bash misc/build "tests"
      - name: Run tests
        run: ./build/desktop-tests-release
      - name: Build app
        run: bash misc/build "app"
      - name: Run app
        run: ./build/desktop-release
      # |
      # ./build/desktop-release &
      # pid=$!
      # sleep 3
      # kill $pid 2>/dev/null || echo "Running app failed" && exit 1
